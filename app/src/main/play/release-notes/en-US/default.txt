Wallet improvements.
Improvements and stability fixes.