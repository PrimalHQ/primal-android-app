Various fixes and ui improvements.